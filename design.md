# 仓颉语法改造技术方案

## 目标范围
- 复用现有 Lua 虚拟机与前端，直接修改词法/语法解析以接受仓颉风格基础语法。
- 覆盖控制流、基础类型、集合类型、函数等基础能力。
- 通过新增测试验证关键语法路径。

## 词法层改动
- 新增关键字：`let`、`var`、`func`、`null`。
- 注释支持：`//` 行注释与 `/* ... */` 块注释（`//` 作为注释起始符，不再作为整数除法运算符）。
- 运算符别名：`&&`/`||` 映射到逻辑与/或，`!`/`!=` 映射到逻辑非/不等。

## 语法层改动
- 变量声明：`let` 解析为只读局部，`var` 解析为可变局部；保留原 Lua `local` 行为。
- 类型标注：在变量、参数与返回类型位置解析 `:` 后的类型并忽略（仅用于语法接受）。
- 函数：`func` 作为 `function` 的同义关键字，函数体允许 `{ ... }`。
- 控制流：`if/else`、`while`、`for` 支持花括号块；`for` 支持 `( ... )` 包裹的循环头部。
- 区间表达式：`a..b`/`a..=b` 解析为仓颉区间，返回可迭代的区间迭代器。
- 类型定义：支持 `class`/`struct` 定义与方法，实例通过 `TypeName(...)` 构造。
- 集合类型：
  - `[...]` 数组字面量映射为 Lua table 的数组部分。
  - `{ "k": v }` 使用 `:` 作为键值分隔符，映射为 table 的记录字段。
  - 集合/数组统一复用 table 语义。
- 空值：`null` 解析为 Lua `nil`。
- 输出：`print` 不自动换行，`println` 在末尾追加换行。

## 测试策略
- 新增 `testes/cangjie.lua`，覆盖：
  - `let/var`、类型标注、`func` 定义/匿名函数
  - `if/else if`、`while`、`for in` 控制流与区间表达式
  - 数组与 map 字面量、注释、逻辑运算符
  - `class`/`struct` 定义、实例化与方法调用
  - `print`/`println` 输出行为
- 调整根目录 `all` 脚本仅运行新测试文件以聚焦仓颉语法验证。
