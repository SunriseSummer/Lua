dofile("cangjie-tests/_testing.cj")

// Test: Array<Byte> type and String <-> byte array conversion

// --- Section: String to Array<Byte> via toArray ---
let s = "Hello"
let bytes = s.toArray()
expectEq(bytes.size, 5, "toArray ASCII byte count")
expectEq(bytes[0], 72, "byte H = 72")
expectEq(bytes[1], 101, "byte e = 101")
expectEq(bytes[2], 108, "byte l = 108")
expectEq(bytes[3], 108, "byte l = 108")
expectEq(bytes[4], 111, "byte o = 111")

// --- Section: CJK string to bytes ---
let cjk = "ä½ "
let cjkBytes = cjk.toArray()
expectEq(cjkBytes.size, 3, "'ä½ ' is 3 bytes in UTF-8")
expectEq(cjkBytes[0], 0xE4, "ä½  byte 0 = 0xE4")
expectEq(cjkBytes[1], 0xBD, "ä½  byte 1 = 0xBD")
expectEq(cjkBytes[2], 0xA0, "ä½  byte 2 = 0xA0")

// --- Section: Emoji to bytes ---
let emoji = "ðŸ˜€"
let emojiBytes = emoji.toArray()
expectEq(emojiBytes.size, 4, "ðŸ˜€ is 4 bytes in UTF-8")
expectEq(emojiBytes[0], 0xF0, "ðŸ˜€ byte 0")
expectEq(emojiBytes[1], 0x9F, "ðŸ˜€ byte 1")
expectEq(emojiBytes[2], 0x98, "ðŸ˜€ byte 2")
expectEq(emojiBytes[3], 0x80, "ðŸ˜€ byte 3")

// --- Section: Array<Byte> back to String ---
let byteArr = s.toArray()
let restored = __cangjie_string_from_byte_array(byteArr)
expectEq(restored, "Hello", "byte array -> String round trip")

let cjkRestored = __cangjie_string_from_byte_array(cjkBytes)
expectEq(cjkRestored, "ä½ ", "CJK byte array -> String round trip")

let emojiRestored = __cangjie_string_from_byte_array(emojiBytes)
expectEq(emojiRestored, "ðŸ˜€", "emoji byte array -> String round trip")

// --- Section: Mixed string round trip ---
let mixed = "Helloä½ å¥½ðŸ˜€"
let mixedBytes = mixed.toArray()
let mixedRestored = __cangjie_string_from_byte_array(mixedBytes)
expectEq(mixedRestored, "Helloä½ å¥½ðŸ˜€", "mixed string round trip")

// --- Section: toRuneArray ---
let runes = "ABä½ å¥½".toRuneArray()
expectEq(runes.size, 4, "toRuneArray size")
expectEq(runes[0], "A", "toRuneArray[0]")
expectEq(runes[1], "B", "toRuneArray[1]")
expectEq(runes[2], "ä½ ", "toRuneArray[2]")
expectEq(runes[3], "å¥½", "toRuneArray[3]")

// --- Section: Empty string ---
let emptyBytes = "".toArray()
expectEq(emptyBytes.size, 0, "empty toArray size")

let emptyRunes = "".toRuneArray()
expectEq(emptyRunes.size, 0, "empty toRuneArray size")

let emptyRestored = __cangjie_string_from_byte_array(emptyBytes)
expectEq(emptyRestored, "", "empty byte array round trip")

// --- Section: Array<Byte> iteration ---
let iterBytes = "Hi".toArray()
var sum = 0
for (i in 0..iterBytes.size) {
    sum = sum + iterBytes[i]
}
expectEq(sum, 72 + 105, "iterate byte array sum")

if (!__test_failed) {
    println("PASS: 74_byte_array")
}
