dofile("cangjie-tests/_testing.cj")

// Test: Native UTF-8 string support
// String indexing returns Rune (Unicode character), .size returns character count

// --- Section: ASCII strings ---
let ascii = "hello"
expectEq(ascii.size, 5, "ASCII .size")
expectEq(ascii[0], r'h', "ASCII index 0")
expectEq(ascii[4], r'o', "ASCII index 4")
expectTrue(type(ascii[0]) == "Rune", "ASCII index returns Rune type")
expectEq(ascii[0..3], "hel", "ASCII slice 0..3")
expectEq(ascii[0..=4], "hello", "ASCII inclusive slice")
expectTrue(type(ascii[0..3]) == "String", "ASCII slice returns String type")

// --- Section: CJK strings ---
let cjk = "‰Ω†Â•Ω‰∏ñÁïå"
expectEq(cjk.size, 4, "CJK .size is 4 characters")
expectEq(cjk[0], r'‰Ω†', "CJK index 0 returns '‰Ω†'")
expectEq(cjk[1], r'Â•Ω', "CJK index 1 returns 'Â•Ω'")
expectEq(cjk[2], r'‰∏ñ', "CJK index 2 returns '‰∏ñ'")
expectEq(cjk[3], r'Áïå', "CJK index 3 returns 'Áïå'")

// --- Section: CJK slicing (returns string) ---
expectEq(cjk[0..2], "‰Ω†Â•Ω", "CJK slice 0..2")
expectEq(cjk[1..3], "Â•Ω‰∏ñ", "CJK slice 1..3")
expectEq(cjk[0..=3], "‰Ω†Â•Ω‰∏ñÁïå", "CJK inclusive slice full")
expectEq(cjk[2..=2], "‰∏ñ", "CJK inclusive slice single char (still string)")
expectTrue(type(cjk[2..=2]) == "String", "CJK single-char slice is String type")
expectEq(cjk[2..2], "", "CJK empty slice")

// --- Section: Mixed ASCII and CJK ---
let mixed = "Hello‰Ω†Â•Ω"
expectEq(mixed.size, 7, "mixed .size is 7")
expectEq(mixed[0], r'H', "mixed index 0")
expectEq(mixed[4], r'o', "mixed index 4")
expectEq(mixed[5], r'‰Ω†', "mixed index 5 (CJK)")
expectEq(mixed[6], r'Â•Ω', "mixed index 6 (CJK)")
expectEq(mixed[0..5], "Hello", "mixed slice ASCII part")
expectEq(mixed[5..=6], "‰Ω†Â•Ω", "mixed slice CJK part")

// --- Section: Emoji characters ---
let emoji = "HiüòÄüéâ"
expectEq(emoji.size, 4, "emoji .size is 4")
expectEq(emoji[0], r'H', "emoji index 0")
expectEq(emoji[1], r'i', "emoji index 1")
expectEq(emoji[2], r'üòÄ', "emoji index 2")
expectEq(emoji[3], r'üéâ', "emoji index 3")
expectEq(emoji[2..=3], "üòÄüéâ", "emoji slice")

// --- Section: Indexed character is Rune ---
// String indexing returns Rune type. Compare with Rune literals.
expectEq(ascii[0], r'h', "ascii[0] == r'h'")
expectEq(cjk[0], r'‰Ω†', "cjk[0] == Rune('‰Ω†')")

// Compare Rune directly
expectTrue(ascii[0] == r'h', "indexed Rune == r'h'")
expectTrue(ascii[0] < r'z', "indexed Rune < r'z'")
expectTrue(ascii[4] > r'a', "indexed Rune > r'a'")

// Rune() identity on indexed Rune
expectEq(Rune(ascii[0]), r'h', "Rune(ascii[0]) == r'h'")

// Int64() extracts code point from indexed character (Rune)
expectEq(Int64(cjk[0]), 0x4F60, "Int64(cjk[0]) == 0x4F60 (‰Ω†)")
expectEq(Int64(mixed[5]), 0x4F60, "Int64(mixed[5]) == 0x4F60 (‰Ω†)")
expectEq(Int64(ascii[0]), 104, "Int64(ascii[0]) == 104 (h)")

// Rune round-trip: String(Rune) -> string
expectEq(String(cjk[1]), "Â•Ω", "String(cjk[1]) == 'Â•Ω'")

// Emoji indexed character code point
expectEq(Int64(emoji[2]), 0x1F600, "Int64(emoji[2]) == 0x1F600 (üòÄ)")

// --- Section: String for-in with UTF-8 ---
let chars = "‰Ω†Â•Ω"
var collected = ""
for (i in 0..chars.size) {
    collected = collected + String(chars[i])
}
expectEq(collected, "‰Ω†Â•Ω", "for-in UTF-8 chars")

// --- Section: Edge cases ---
let empty = ""
expectEq(empty.size, 0, "empty string .size")

let single_ascii = "A"
expectEq(single_ascii.size, 1, "single ASCII .size")
expectEq(single_ascii[0], r'A', "single ASCII index")

let single_cjk = "‰∏≠"
expectEq(single_cjk.size, 1, "single CJK .size")
expectEq(single_cjk[0], r'‰∏≠', "single CJK index")

let single_emoji = "üåç"
expectEq(single_emoji.size, 1, "single emoji .size")
expectEq(single_emoji[0], r'üåç', "single emoji index")

// --- Section: Interpolation with UTF-8 ---
let name = "‰ªìÈ¢â"
let greeting = "Hello, ${name}!"
expectEq(greeting.size, 10, "interpolation UTF-8 .size")
expectEq(greeting[7], r'‰ªì', "interpolation UTF-8 index 7")
expectEq(greeting[8], r'È¢â', "interpolation UTF-8 index 8")

// --- Section: String concatenation with UTF-8 ---
let concat = "‰Ω†" + "Â•Ω" + "‰∏ñ" + "Áïå"
expectEq(concat.size, 4, "concat UTF-8 .size")
expectEq(concat, "‰Ω†Â•Ω‰∏ñÁïå", "concat UTF-8 equality")

if (!__test_failed) {
    println("PASS: 72_utf8_string")
}
